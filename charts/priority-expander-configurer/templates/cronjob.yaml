apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: {{ .Release.Name }}
spec:
  schedule: "*/5 * * * *"
  successfulJobsHistoryLimit: 2
  failedJobsHistoryLimit: 2
  jobTemplate:
    spec:
      backoffLimit: 2
      template:
        spec:
          {{- with .Values.annotations }}
          metadata:
            annotations:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          serviceAccountName: {{ .Release.Name }}
          restartPolicy: OnFailure
          containers:
          - name: priority-expander-configurer
            image: {{ .Values.image.repository }}:{{ .Values.image.tag }}
            env:
            {{- range $key, $value := .Values.env }}
            - name: {{ $key }}
              value: {{ $value | quote }}
            {{- end }}
            - name: CONFIGMAP_NAME
              value: {{ .Release.Name | quote }}

